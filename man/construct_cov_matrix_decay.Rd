% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/construct_cov_matrix_decay.R
\name{construct_cov_matrix_decay}
\alias{construct_cov_matrix_decay}
\title{Construct a Covariance Matrix with Decaying Correlations}
\usage{
construct_cov_matrix_decay(
  years,
  variances,
  decay_type = "exponential",
  decay_param,
  min_decay_param = 0,
  max_decay_param = 1,
  n_steps = 1000
)
}
\arguments{
\item{years}{Numeric vector of years corresponding to the estimates.}

\item{variances}{Numeric vector of variances for each estimate. Must be non-negative
and the same length as \code{years}.}

\item{decay_type}{Character string specifying the type of decay function to use.
Supported options are \code{"exponential"} and \code{"linear"}.}

\item{decay_param}{Numeric value specifying the decay parameter (\eqn{\lambda}) for
the decay function. Must be within \code{[min_decay_param, max_decay_param]}.}

\item{min_decay_param}{Numeric value specifying the minimum allowable decay parameter.
Default is \code{0}.}

\item{max_decay_param}{Numeric value specifying the maximum allowable decay parameter.
Default is \code{1}.}

\item{n_steps}{Integer specifying the number of steps for adjusting the decay parameter
to find a positive semi-definite covariance matrix. Default is \code{1000}.}
}
\value{
A list containing:
\describe{
\item{\code{cov_matrix}}{The constructed covariance matrix, which is positive semi-definite.}
\item{\code{decay_param}}{The decay parameter used to construct the covariance matrix.
If the initial \code{decay_param} resulted in a non-PSD matrix, this is the adjusted value.}
}
}
\description{
Constructs a covariance matrix for Difference-in-Differences (DiD) estimates,
assuming that covariances decay over time according to a specified decay function.
The function ensures that the resulting covariance matrix is positive semi-definite (PSD)
by adjusting the decay parameter if necessary.
}
\examples{
# Example 1: Using a specified decay parameter (exponential decay)
years <- c(2008, 2009, 2010, 2011)
variances <- c(0.0001, 0.0002, 0.00015, 0.00012)
decay_param <- 0.1
result_exp <- construct_cov_matrix_decay(
  years = years,
  variances = variances,
  decay_type = "exponential",
  decay_param = decay_param
)
print(result_exp$cov_matrix)
print(result_exp$decay_param)

# Example 2: Using a specified decay parameter (linear decay)
decay_param <- 0.2
result_lin <- construct_cov_matrix_decay(
  years = years,
  variances = variances,
  decay_type = "linear",
  decay_param = decay_param
)
print(result_lin$cov_matrix)
print(result_lin$decay_param)

# Example 3: Specified decay parameter resulting in non-PSD matrix (adjusted)
decay_param <- 0.05  # May result in non-PSD matrix
result_adjusted <- construct_cov_matrix_decay(
  years = years,
  variances = variances,
  decay_type = "exponential",
  decay_param = decay_param
)
print(result_adjusted$cov_matrix)
print(result_adjusted$decay_param)

# Example 4: Perfect correlation (decay_param = 0)
decay_param <- 0
result_perfect <- construct_cov_matrix_decay(
  years = years,
  variances = variances,
  decay_type = "exponential",
  decay_param = decay_param
)
print(result_perfect$cov_matrix)
print(result_perfect$decay_param)
}
